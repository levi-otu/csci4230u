# Getting Started with The Public Square

This guide will help you set up The Public Square development environment on your local machine.

## Prerequisites

Before setting up the project, ensure you have the following installed:

**Required:**
- **Git** - For cloning the repository
- **Node.js 20+** and **npm** - For frontend development
- **Python 3.10+** - For backend development
- **PostgreSQL 14+** - Database server
- **uv** - Fast Python package manager (will be installed during backend setup)

**Optional:**
- **Docker** - For containerized deployment
- **Make** - For using Makefile commands (usually pre-installed on Linux/macOS)

## Quick Start

```bash
# Clone the repository
git clone https://github.com/YOUR_USERNAME/csci4230u.git
cd csci4230u
```

## Backend Setup

The backend uses a Makefile to simplify the setup process. All commands should be run from the `backend/` directory.

```bash
cd backend
```

### Step 1: Initial Setup (Install uv and PostgreSQL)

```bash
make setup
```

This command will:
- Install `uv` package manager
- Install PostgreSQL (if not already installed)
- Start PostgreSQL service

### Step 2: Create Database

```bash
make create-db
```

Follow the prompts to create the database. You'll need to run these SQL commands in the PostgreSQL console:

```sql
CREATE DATABASE public_square;
CREATE USER your_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE public_square TO your_user;
CREATE DATABASE public_square_test;
GRANT ALL PRIVILEGES ON DATABASE public_square_test TO your_user;
\q
```

### Step 3: Install Dependencies and Configure Environment

```bash
make install
```

This command will:
- Install Python dependencies using `uv`
- Generate a `.env` file with a random SECRET_KEY
- Run database migrations

**Important:** Update the `.env` file with your database credentials:

```bash
# Edit .env file
DATABASE_URL=postgresql+asyncpg://your_user:your_password@localhost:5432/public_square
TEST_DATABASE_URL=postgresql+asyncpg://your_user:your_password@localhost:5432/public_square_test
SECRET_KEY=<auto-generated>
```

### Step 4: Start the Backend Server

```bash
make start
```

The backend API will be available at `http://localhost:8000`

**API Documentation:**
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### Additional Backend Commands

```bash
# Run tests
make test

# Run database migrations manually
make migrate

# Start PostgreSQL service only
make start-db

# Access PostgreSQL console
make psql

# Clean up generated files
make clean

# View all available commands
make help
```

## Frontend Setup

The frontend is a React + TypeScript application using Vite. All commands should be run from the `frontend/app/` directory.

```bash
cd frontend/app
```

### Step 1: Install Dependencies

```bash
npm install
```

### Step 2: Configure Environment

Create a `.env` file in the `frontend/app/` directory:

```bash
# Frontend environment variables
VITE_API_BASE_URL=http://localhost:8000
```

### Step 3: Start Development Server

```bash
npm run dev
```

The frontend will be available at `http://localhost:5173`

### Additional Frontend Commands

```bash
# Build for production
npm run build

# Preview production build
npm run preview

# Run linter
npm run lint
```

## Running the Full Stack

To run both backend and frontend simultaneously:

1. **Terminal 1 - Backend:**
   ```bash
   cd backend
   make start
   ```

2. **Terminal 2 - Frontend:**
   ```bash
   cd frontend/app
   npm run dev
   ```

3. **Access the application:**
   - Frontend: http://localhost:5173
   - Backend API: http://localhost:8000
   - API Docs: http://localhost:8000/docs

## Docker Setup (Optional)

### Backend Docker

```bash
cd backend
docker build -t public-square-backend .
docker run -p 8000:8000 public-square-backend
```

### Frontend Docker

```bash
cd frontend
docker build -f Dockerfile -t public-square-frontend ..
docker run -p 80:80 public-square-frontend
```

## Troubleshooting

### Backend Issues

**PostgreSQL connection errors:**
- Ensure PostgreSQL is running with `make start-db`
- Verify your credentials in `.env` match your database user

**Migration errors:**
- Try `make migrate` to manually run migrations
- Check if database exists with `make psql`

**Import errors:**
- Run `make install` to ensure all dependencies are installed
- Verify Python version is 3.10+

**Port 8000 already in use:**
- Kill the process: `lsof -ti:8000 | xargs kill -9`

### Frontend Issues

**Module not found errors:**
- Delete `node_modules` and run `npm install` again
- Clear npm cache: `npm cache clean --force`

**API connection errors:**
- Verify backend is running at http://localhost:8000
- Check `.env` file has correct `VITE_API_BASE_URL`

**Port 5173 already in use:**
- Vite will automatically use the next available port
- Or specify a port: `npm run dev -- --port 3000`

### Database Issues

**Permission denied:**
- Ensure your database user has the correct privileges
- Grant permissions: `GRANT ALL PRIVILEGES ON DATABASE public_square TO your_user;`

**Database does not exist:**
- Run `make create-db` to create the database
- Or manually create with `psql -U postgres -c "CREATE DATABASE public_square;"`

**Connection refused:**
- Check if PostgreSQL is running: `sudo service postgresql status`
- Start PostgreSQL: `make start-db`

## Next Steps

Once you have the application running:

1. **Create an account:** Navigate to http://localhost:5173 and register
2. **Explore the API:** Visit http://localhost:8000/docs for interactive API documentation
3. **Add books:** Use the Library feature to add books via ISBN lookup
4. **Create a club:** Start your first book club and invite friends
5. **Run tests:** Ensure everything works with `make test` in the backend directory

## Additional Resources

- [Architecture Documentation](ARCHITECTURE.md) - System architecture and design decisions
- [Data Models](models.md) - Database schema and relationships
- [Requirements](requirements.md) - Project requirements and features
- [CI/CD Setup](CICD_SETUP.md) - Deployment and continuous integration guide
